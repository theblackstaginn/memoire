<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Memoire</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- DESK SCENE -->
  <div id="scene">
    <img id="desk-bg" src="./memoire-assets/desk.png" alt="Desk with journal" />
    <button id="book-hitbox" aria-label="Open journal">
      <img src="./memoire-assets/book.png" alt="Closed journal" />
    </button>
  </div>

  <!-- GLOBAL MODAL OVERLAY -->
  <div id="modal-overlay" class="hidden">

    <!-- 1. WARNING MODAL -->
    <div id="warning-modal" class="modal card">
      <div class="modal-header">
        <img src="./memoire-assets/quill-icon.png" class="modal-icon" alt="">
        <button class="icon-button" id="warning-close">
          <img src="./memoire-assets/x-button.png" alt="">
        </button>
      </div>
      <div class="modal-body">
        <p><strong>Warning:</strong> explicit adult content. ðŸ˜‰</p>
      </div>
      <div class="modal-footer">
        <button id="warning-leave" class="btn secondary">Leave</button>
        <button id="warning-ok" class="btn primary">OK</button>
      </div>
    </div>

    <!-- 2. MODE CHOOSER -->
    <div id="mode-modal" class="modal card hidden">
      <div class="modal-header">
        <img src="./memoire-assets/read-icon.png" class="modal-icon" alt="">
        <button class="icon-button" id="mode-close">
          <img src="./memoire-assets/x-button.png" alt="">
        </button>
      </div>
      <div class="modal-body">
        <p>What would you like to do?</p>
        <div class="mode-buttons">
          <button id="mode-read" class="mode-btn">
            <img src="./memoire-assets/read-icon.png" alt="">
            <span>Read</span>
          </button>
          <button id="mode-edit" class="mode-btn">
            <img src="./memoire-assets/quill-icon.png" alt="">
            <span>Edit</span>
          </button>
        </div>
      </div>
      <div class="modal-footer">
        <button id="mode-back" class="btn secondary">&larr; Back</button>
      </div>
    </div>

    <!-- 2B. PASSWORD MODAL -->
    <div id="password-modal" class="modal card hidden">
      <div class="modal-header">
        <img src="./memoire-assets/quill-icon.png" class="modal-icon" alt="">
        <button class="icon-button" id="password-close">
          <img src="./memoire-assets/x-button.png" alt="">
        </button>
      </div>
      <div class="modal-body">
        <p>Enter password to unlock editor:</p>
        <div class="input-row">
          <input type="password" id="edit-password-input" placeholder="Password">
        </div>
        <p id="password-error" class="error hidden">Incorrect password.</p>
      </div>
      <div class="modal-footer">
        <button id="password-cancel" class="btn secondary">Cancel</button>
        <button id="password-submit" class="btn primary">Unlock</button>
      </div>
    </div>

    <!-- 3. READER MODAL -->
    <div id="reader-modal" class="modal reader hidden">
      <button class="icon-button close-top-right" id="reader-close">
        <img src="./memoire-assets/x-button.png" alt="">
      </button>

      <div id="reader-frame">
        <img src="./memoire-assets/open-book.png" id="reader-book" alt="Open book">

        <div id="pages">
          <div class="page left">
            <div class="page-inner" id="page-left"></div>
          </div>
          <div class="page right">
            <div class="page-inner" id="page-right"></div>
          </div>
        </div>

        <button id="prev-page" class="nav-btn left">
          <img src="./memoire-assets/back-button.png" alt="">
        </button>
        <button id="next-page" class="nav-btn right">
          <img src="./memoire-assets/forward-button.png" alt="">
        </button>
      </div>
    </div>

    <!-- 4. EDITOR MODAL -->
    <div id="editor-modal" class="modal editor hidden">
      <button class="icon-button close-top-right" id="editor-close">
        <img src="./memoire-assets/x-button.png" alt="">
      </button>
      <div id="editor-scroll">
        <div id="editor-page" contenteditable="true">
          Start writing your entry here...
        </div>
      </div>
    </div>

  </div>

  <!-- INLINE JS: IGNORE app.js FOR NOW -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const overlay = document.getElementById('modal-overlay');

      const book = document.getElementById('book-hitbox');

      // warning
      const warningModal = document.getElementById('warning-modal');
      const warningOk = document.getElementById('warning-ok');
      const warningLeave = document.getElementById('warning-leave');
      const warningClose = document.getElementById('warning-close');

      // mode
      const modeModal = document.getElementById('mode-modal');
      const modeRead = document.getElementById('mode-read');
      const modeEdit = document.getElementById('mode-edit');
      const modeBack = document.getElementById('mode-back');
      const modeClose = document.getElementById('mode-close');

      // password
      const passwordModal = document.getElementById('password-modal');
      const passwordInput = document.getElementById('edit-password-input');
      const passwordSubmit = document.getElementById('password-submit');
      const passwordCancel = document.getElementById('password-cancel');
      const passwordClose = document.getElementById('password-close');
      const passwordError = document.getElementById('password-error');

      // reader
      const readerModal = document.getElementById('reader-modal');
      const readerClose = document.getElementById('reader-close');
      const prevBtn = document.getElementById('prev-page');
      const nextBtn = document.getElementById('next-page');
      const leftPage = document.getElementById('page-left');
      const rightPage = document.getElementById('page-right');

      // editor
      const editorModal = document.getElementById('editor-modal');
      const editorClose = document.getElementById('editor-close');

      const EDIT_PASSWORD = "memoire!"; // change if you want

      const pages = [
        "Page 1\n\nThis is a placeholder entry. Replace with your real content.",
        "Page 2\n\nEverything loads directly over the parchment.",
        "Page 3\n\nMore content...",
        "Page 4\n\nMore content..."
      ];
      let index = 0;

      function show(el){ el && el.classList.remove('hidden'); }
      function hide(el){ el && el.classList.add('hidden'); }

      function exitAll(){
        hide(warningModal);
        hide(modeModal);
        hide(passwordModal);
        hide(readerModal);
        hide(editorModal);
        hide(overlay);
      }

      function renderPages(){
        if (leftPage)  leftPage.textContent  = pages[index] || "";
        if (rightPage) rightPage.textContent = pages[index+1] || "";
      }

      // open sequence
      if (book) {
        book.addEventListener('click', () => {
          show(overlay);
          show(warningModal);
        });
      }

      // warning
      if (warningOk) {
        warningOk.addEventListener('click', () => {
          hide(warningModal);
          show(modeModal);
        });
      }
      if (warningLeave) warningLeave.addEventListener('click', exitAll);
      if (warningClose) warningClose.addEventListener('click', exitAll);

      // mode
      if (modeBack) {
        modeBack.addEventListener('click', () => {
          hide(modeModal);
          show(warningModal);
        });
      }
      if (modeClose) modeClose.addEventListener('click', exitAll);

      if (modeRead) {
        modeRead.addEventListener('click', () => {
          hide(modeModal);
          index = 0;
          renderPages();
          show(readerModal);
        });
      }

      if (modeEdit) {
        modeEdit.addEventListener('click', () => {
          hide(modeModal);
          if (passwordInput) passwordInput.value = "";
          hide(passwordError);
          show(passwordModal);
        });
      }

      // password
      if (passwordSubmit) {
        passwordSubmit.addEventListener('click', () => {
          if (!passwordInput) return;

          if (passwordInput.value === EDIT_PASSWORD) {
            hide(passwordModal);
            show(editorModal);
          } else {
            show(passwordError);
          }
        });
      }

      if (passwordCancel) {
        passwordCancel.addEventListener('click', () => {
          hide(passwordModal);
          show(modeModal);
        });
      }

      if (passwordClose) {
        passwordClose.addEventListener('click', () => {
          hide(passwordModal);
          show(modeModal);
        });
      }

      // reader nav
      if (readerClose) readerClose.addEventListener('click', exitAll);

      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          if (index + 2 < pages.length) {
            index += 2;
            renderPages();
          }
        });
      }

      if (prevBtn) {
        prevBtn.addEventListener('click', () => {
          if (index - 2 >= 0) {
            index -= 2;
            renderPages();
          }
        });
      }

      // editor
      if (editorClose) editorClose.addEventListener('click', exitAll);
    });
  </script>
</body>
</html>